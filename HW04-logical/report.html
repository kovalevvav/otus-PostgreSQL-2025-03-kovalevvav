<head></head><body><ul style="border: 0px; font-style: normal; font-weight: 400; font-size: 18px; line-height: inherit; font-family: Roboto, sans-serif; margin: 0px; padding: 0px 0px 0px 24px; vertical-align: baseline; list-style: disc; color: rgb(5, 5, 5); text-align: start; text-indent: 0px; white-space: normal;">
	<h2>
		<strong>Работа с базами данных, пользователями и правами</strong>
	</h2>
	<p> 1. создайте новый кластер PostgresSQL 14</p>
	<p> 2. зайдите в созданный кластер под пользователем postgres</p>
	<p> 3. создайте новую базу данных testdb</p><pre><span style="color: rgb(112, 173, 71); font-weight: bold; text-decoration: inherit;"><em><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;">CREATE</span> <span style="color:#800000;font-weight:bold;">DATABASE</span> <span style="color:#000000;">testdb</span><span style="color:#ff0000;">;</span></span></span></em></span></pre>
	<p> 4. зайдите в созданную базу данных под пользователем postgres</p>
	<p> 5. создайте новую схему testnm</p><div style="background-color:#ffffff;padding:0px 0px 0px 2px;"><div style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><p style="margin:0;"><span style="color:#800000;font-weight:bold;"><em>DROP</em></span> <span style="color:#800000;font-weight:bold;"><em>SCHEMA</em></span> <span style="color:#800000;font-weight:bold;"><em>IF</em></span> <span style="color:#800000;font-weight:bold;"><em>EXISTS</em></span> <span style="color:#000000;"><em>testnm</em></span> <span style="color:#800000;font-weight:bold;"><em>CASCADE</em></span><span style="color:#ff0000;"><em>;</em></span></p><p style="margin:0;"><span style="color:#800000;font-weight:bold;"><em>CREATE</em></span> <span style="color:#800000;font-weight:bold;"><em>SCHEMA</em></span> <span style="color:#800000;font-weight:bold;"><em>IF</em></span> <span style="color:#800000;font-weight:bold;"><em>NOT</em></span> <span style="color:#800000;font-weight:bold;"><em>EXISTS</em></span> <span style="color:#000000;"><em>testnm</em></span><span style="color:#ff0000;">;</span></p></div></div><div style="background-color:#ffffff;padding:0px 0px 0px 2px;"><p style="margin:0;"><span style="color:#ff0000;"><br></span></p></div>
	<p> 6. создайте новую таблицу t1 с одной колонкой c1 типа integer</p><div style="background-color:#ffffff;padding:0px 0px 0px 2px;"><div style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><div style="background-color:#ffffff;padding:0px 0px 0px 2px;"><div style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><p style="margin:0;"><span style="color:#800000;font-weight:bold;"><em>CREATE</em></span> <span style="color:#800000;font-weight:bold;"><em>TABLE</em></span> <span style="color:#8e00c6;"><em>t1</em></span></p><p style="margin:0;"><em>(</em></p><p style="margin:0;">    <span style="color:#006464;"><em>c1</em></span> <span style="color:#000080;font-weight:bold;"><em>integer</em></span></p><p style="margin:0;"><em>)</em><span style="color:#ff0000;"><em>;</em></span></p></div></div></div></div>
	<p> 7. вставьте строку со значением c1=1</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>INSERT</em></span> <span style="color:#800000;font-weight:bold;"><em>INTO</em></span> <span style="color:#956037;"><em>testnm</em></span><em>.</em><span style="color:#8e00c6;"><em>t1</em></span><em>(</em><span style="color:#6c5151;"><em>c1</em></span><em>) </em><span style="color:#800000;font-weight:bold;"><em>VALUES</em></span><em>(</em><span style="color:#0000ff;"><em>1</em></span><em>)</em><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p> 8. создайте новую роль readonly</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>CREATE</em></span> <span style="color:#800000;font-weight:bold;"><em>ROLE</em></span> <span style="color:#000000;"><em>readonly</em></span><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p> 9. дайте новой роли право на подключение к базе данных testdb</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>GRANT</em></span> <span style="color:#800000;font-weight:bold;"><em>CONNECT</em></span> <span style="color:#800000;font-weight:bold;"><em>ON</em></span> <span style="color:#800000;font-weight:bold;"><em>DATABASE</em></span> <span style="color:#000000;"><em>testdb</em></span> <span style="color:#800000;font-weight:bold;"><em>TO</em></span> <span style="color:#000000;"><em>readonly</em></span><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p>10. дайте новой роли право на использование схемы testnm</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>GRANT</em></span> <span style="color:#800000;font-weight:bold;"><em>USAGE</em></span> <span style="color:#800000;font-weight:bold;"><em>ON</em></span> <span style="color:#800000;font-weight:bold;"><em>SCHEMA</em></span> <span style="color:#000000;"><em>testnm</em></span> <span style="color:#800000;font-weight:bold;"><em>TO</em></span> <span style="color:#000000;"><em>readonly</em></span><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p>11. дайте новой роли право на select для всех таблиц схемы testnm</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>GRANT</em></span> <span style="color:#800000;font-weight:bold;"><em>SELECT</em></span> <span style="color:#800000;font-weight:bold;"><em>ON</em></span> <span style="color:#800000;font-weight:bold;"><em>ALL</em></span> <span style="color:#800000;font-weight:bold;"><em>TABLES</em></span> <span style="color:#800000;font-weight:bold;"><em>IN</em></span> <span style="color:#800000;font-weight:bold;"><em>SCHEMA</em></span> <span style="color:#000000;"><em>testnm</em></span> <span style="color:#800000;font-weight:bold;"><em>TO</em></span> <span style="color:#000000;"><em>readonly</em></span><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p>12. создайте пользователя testread с паролем test123</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>CREATE</em></span> <span style="color:#800000;font-weight:bold;"><em>USER</em></span> <span style="color:#000000;"><em>testread</em></span> <span style="color:#800000;font-weight:bold;"><em>WITH</em></span> <span style="color:#800000;font-weight:bold;"><em>PASSWORD</em></span> <span style="color:#008000;"><em>'test123'</em></span><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p>13. дайте роль readonly пользователю testread</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 2px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Consolas&quot;;font-size:10pt;white-space:pre;"><span style="color:#800000;font-weight:bold;"><em>GRANT</em></span> <span style="color:#000000;"><em>readonly</em></span> <span style="color:#800000;font-weight:bold;"><em>TO</em></span> <span style="color:#000000;"><em>testread</em></span><span style="color:#ff0000;"><em>;</em></span></span></span><br></p>
	<p>14. зайдите под пользователем testread в базу данных testdb</p><p><span style="background-color: unset;">15. сделайте select * from t1;</span></p>
	<p>16. получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)</p><p><span style="color: rgb(112, 173, 71); text-decoration: inherit;"><em>не получилось</em></span></p>
	<p>17. напишите что именно произошло в тексте домашнего задания</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 0px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Courier New&quot;;font-size:10pt;white-space:pre-wrap;">SQL Error [42501]: ERROR: permission denied for table t1</span></span><br></p>
	<p>18. у вас есть идеи почему? ведь права то дали?</p>
	<p>19. посмотрите на список таблиц</p>
	<p>20. подсказка в шпаргалке под пунктом 20</p>
	<p>21. а почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)</p><p><span style="color: rgb(112, 173, 71); text-decoration: inherit;"><em>при создании таблицы не указали явно схему</em></span></p>
	<p>22. вернитесь в базу данных testdb под пользователем postgres</p>
	<p>23. удалите таблицу t1</p>
	<p>24. создайте ее заново но уже с явным указанием имени схемы testnm</p>
	<p>25. вставьте строку со значением c1=1</p>
	<p>26. зайдите под пользователем testread в базу данных testdb</p>
	<p>27. сделайте select * from testnm.t1;</p>
	<p>28. получилось?</p><p><span style="color: rgb(83, 129, 53); text-decoration: inherit;"><em>н</em></span><span style="color: rgb(112, 173, 71); text-decoration: inherit;"><em>е получилось</em></span></p>
	<p>29. есть идеи почему? если нет - смотрите шпаргалку</p>
	<p>30. как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку</p>
	<p>31. сделайте select * from testnm.t1;</p>
	<p>32. получилось?</p>
	<p>33. есть идеи почему? если нет - смотрите шпаргалку</p><p><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>GRANT</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>SELECT</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>ON</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>ALL</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>TABLES</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>IN</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>SCHEMA</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre;"><em>testnm</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"> </span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>TO</em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"><em> testread</em></span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; color: rgb(255, 0, 0);"><em>;</em></span><br></p>
	<p>34. сделайте select * from testnm.t1;</p>
	<p>35. получилось?</p>
	<p>36. ура!</p>
	<p>37. теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 0px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Courier New&quot;;font-size:10pt;white-space:pre-wrap;"><em style=" color: rgb(112, 173, 71); font-family: Roboto, sans-serif; font-size: 18px; font-weight: 400; text-align: start; text-indent: 0px; white-space: normal; background-color: rgb(255, 255, 255);">получилось</em></span></span><br></p>
	<p>38. а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?</p><p><em style=" font-weight: 400; text-align: start; text-indent: 0px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(112, 173, 71); font-family: Roboto, sans-serif; font-size: 18px;">пользователь унаследовал права от своего owner, так как при создании по умолчанию установлен параметр INHERIT</em><br></p>
	<p>39. есть идеи как убрать эти права? если нет - смотрите шпаргалку</p><pre><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>ALTER </em></span><span style="color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255); display: inline !important; float: none;"></span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; text-align: start; text-indent: 0px; white-space: pre; color: rgb(128, 0, 0); font-weight: bold;"><em>USER </em></span><span style=" color: rgb(0, 0, 0); font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre;"><em>testread <em style=" color: rgb(128, 0, 0); font-family: Consolas; font-size: 13.3333px; font-weight: 700; text-align: start; text-indent: 0px; white-space: pre; background-color: rgb(255, 255, 255);">NOINHERIT</em></em></span><span style=" font-family: Consolas; font-size: 13.3333px; font-style: normal; font-weight: 400; text-align: start; text-indent: 0px; white-space: pre; color: rgb(255, 0, 0);"><em>;</em></span><br></pre>
	<p>40. если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды</p>
	<p>41. теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);</p><p><span style="background-color:#ffffff;padding:0px 0px 0px 0px;"><span style="color:#000000;background-color:#ffffff;font-family:&quot;Courier New&quot;;font-size:10pt;white-space:pre-wrap;">SQL Error [42501]: ERROR: permission denied for schema public</span></span><br></p>
	<p>42. расскажите что получилось и почему</p><p><span style="color: rgb(112, 173, 71); text-decoration: inherit;"><em>Так как у пользователя отобрали унаследованные права, у него остались только выданные явно через GRANT привилегии, то есть в данном случае только SELECT на все таблицы&nbsp;</em></span></p>
</ul></body>